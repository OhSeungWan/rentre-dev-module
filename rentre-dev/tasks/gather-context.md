# Gather Context Task - 부족한 컨텍스트 수집

백로그 분해에 필요한 부족한 컨텍스트를 적극적으로 파악하고 요청하는 태스크

## 용도

이 태스크는 prepare-backlog 워크플로우에서 호출되거나, PM 에이전트의 `*gather` 명령으로 독립 실행됩니다.
백로그를 분해하기 전 **필수 컨텍스트가 충분한지 검증**하고, 부족한 경우 **적극적으로 요청**합니다.

**사용 시나리오:**

- 백로그 준비 중 필수 정보 누락 감지
- 분해 전 컨텍스트 완성도 검증
- 추가 자료 요청 체크리스트 생성

## 입력 파라미터 (워크플로우에서 호출 시)

```yaml
backlog_type: Epic | Story | Task | Bug | etc.
backlog_title: '백로그 제목'
backlog_description: '백로그 설명'
requirements: [REQ-001, REQ-002, ...] # 구조화된 요구사항 (있는 경우)
acceptance_criteria: [AC-001, AC-002, ...] # 구조화된 수용기준 (있는 경우)
existing_context:
  figma: { url, file_key, node_id } # 있는 경우
  references: [...] # 있는 경우
  parent_info: { ... } # 있는 경우
```

## 실행 단계

### 1. 백로그 유형별 필수 컨텍스트 체크리스트 로드

백로그 유형에 따라 필수/권장 컨텍스트 항목이 다릅니다:

#### Epic 분해 시 필수 컨텍스트

| 항목            | 필수/권장 | 설명                            |
| --------------- | --------- | ------------------------------- |
| 비즈니스 목표   | 필수      | Epic이 달성하려는 비즈니스 가치 |
| 성공 지표 (KPI) | 필수      | 측정 가능한 성공 기준           |
| 대상 사용자     | 필수      | 누구를 위한 기능인지            |
| 범위 정의       | 필수      | 포함/제외 범위 명확화           |
| 기술적 제약사항 | 권장      | 기술 스택, 성능 요구사항        |
| 일정 제약       | 권장      | 마감일, 마일스톤                |
| 의존성          | 권장      | 다른 Epic/외부 시스템 의존      |

#### Story 분해 시 필수 컨텍스트

| 항목            | 필수/권장 | 설명                                              |
| --------------- | --------- | ------------------------------------------------- |
| 사용자 시나리오 | 필수      | As a... I want... So that...                      |
| 수용 기준       | 필수      | 명확한 완료 조건                                  |
| UI/UX 디자인    | 권장\*    | 피그마 링크 또는 와이어프레임 (\*UI 관련 시 필수) |
| API 스펙        | 권장\*    | API 연동 시 필수                                  |
| 데이터 모델     | 권장      | 관련 데이터 구조                                  |
| 에러 처리 정책  | 권장      | 예외 상황 처리 방법                               |

#### Task/Subtask 분해 시 필수 컨텍스트

| 항목             | 필수/권장 | 설명                  |
| ---------------- | --------- | --------------------- |
| 구현 범위        | 필수      | 수정할 파일/모듈 범위 |
| 기술적 접근 방식 | 권장      | 구현 방법 가이드      |
| 기존 코드 참조   | 권장      | 참고할 기존 구현      |
| 테스트 범위      | 권장      | 필요한 테스트 유형    |

#### Bug 수정 시 필수 컨텍스트

| 항목      | 필수/권장 | 설명                          |
| --------- | --------- | ----------------------------- |
| 재현 단계 | 필수      | 버그 재현 방법                |
| 예상 동작 | 필수      | 올바른 동작이 무엇인지        |
| 현재 동작 | 필수      | 실제로 발생하는 문제          |
| 환경 정보 | 권장      | 브라우저, OS, 버전 등         |
| 에러 로그 | 권장      | 관련 에러 메시지/스택트레이스 |
| 영향 범위 | 권장      | 어떤 사용자/기능에 영향       |

### 2. 현재 컨텍스트 충족도 검증

#### 2.1 필수 항목 체크

각 필수 항목에 대해:

- ✅ 충족: 백로그 내용에서 확인됨
- ⚠️ 부분 충족: 언급은 있으나 불명확
- ❌ 미충족: 정보 없음

#### 2.2 권장 항목 체크

각 권장 항목에 대해:

- ✅ 제공됨
- ➖ 해당 없음 (이 백로그에는 불필요)
- ❓ 있으면 좋음

#### 2.3 충족도 점수 계산

```
충족도 = (충족된 필수 항목 수 / 전체 필수 항목 수) × 100%

- 100%: 분해 준비 완료
- 80-99%: 분해 가능, 일부 가정 필요
- 50-79%: 추가 정보 필요
- <50%: 분해 불가, 필수 정보 수집 필요
```

### 3. 부족한 컨텍스트 요청

#### 3.1 요청 메시지 생성

부족한 항목에 대해 구체적이고 액션 가능한 질문 생성:

**템플릿:**

```markdown
## 📋 컨텍스트 수집 요청

**백로그:** {backlog_type} - {backlog_title}
**현재 충족도:** {fulfillment_score}%

---

### ❌ 필수 정보 요청 ({missing_required_count}개)

다음 정보가 없으면 백로그 분해가 어렵습니다:

1. **{missing_item_1}**
   - 왜 필요한가: {reason_1}
   - 예시: {example_1}
   - 💡 힌트: {hint_1}

2. **{missing_item_2}**
   - 왜 필요한가: {reason_2}
   - 예시: {example_2}
   - 💡 힌트: {hint_2}

---

### ⚠️ 권장 정보 요청 ({missing_recommended_count}개)

있으면 더 정확한 분해가 가능합니다:

1. **{recommended_item_1}**
   - 도움이 되는 이유: {benefit_1}

---

### 📎 자료 첨부 가이드

- **피그마 디자인**: 링크 또는 스크린샷
- **API 문서**: Swagger/OpenAPI 링크 또는 엔드포인트 설명
- **기존 코드 참조**: 파일 경로 또는 GitHub 링크
- **에러 로그**: 콘솔 출력 또는 로그 파일
```

#### 3.2 우선순위별 요청

1. **즉시 필요** (필수 & 미충족): 이 정보 없이는 진행 불가
2. **곧 필요** (필수 & 부분 충족): 명확화 필요
3. **있으면 좋음** (권장): 품질 향상에 도움

### 4. 결과 출력

```markdown
## 📊 컨텍스트 수집 결과

### 충족도 요약

| 카테고리  | 충족     | 부분          | 미충족        | 점수               |
| --------- | -------- | ------------- | ------------- | ------------------ |
| 필수 항목 | {req_ok} | {req_partial} | {req_missing} | {req_score}%       |
| 권장 항목 | {rec_ok} | {rec_na}      | {rec_missing} | {rec_score}%       |
| **전체**  |          |               |               | **{total_score}%** |

### 분해 가능 여부

{분해*가능*여부\_판정}

### 다음 단계

{다음*단계*안내}
```

## 반환값 (워크플로우로 반환 시)

```yaml
context_score: 85 # 충족도 점수 (0-100)
can_decompose: true | false # 분해 가능 여부
missing_required: # 미충족 필수 항목
  - item: '수용 기준'
    reason: '완료 조건이 명확하지 않음'
    question: '이 기능이 완료되었다고 판단하는 기준은 무엇인가요?'
missing_recommended: # 미충족 권장 항목
  - item: '피그마 디자인'
    benefit: 'UI 구현 정확도 향상'
gathered_context: # 사용자가 제공한 추가 컨텍스트
  - item: 'API 스펙'
    content: '...'
```

## 연계

- **prepare-backlog**: Step 4 이후 또는 Step 3 이후에 호출
- **decompose-backlog**: 분해 전 컨텍스트 검증용으로 호출 가능
- **PM 에이전트**: `*gather` 명령으로 독립 실행 가능
