# Analyze Codebase - ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ì›Œí¬í”Œë¡œìš°

<critical>The workflow execution engine is governed by: {project-root}/.bmad/core/tasks/workflow.xml</critical>
<critical>Communicate in {communication_language} throughout</critical>
<critical>This workflow can be invoked standalone OR from other workflows (decompose-backlog, start-task)</critical>

<workflow>

<step n="1" goal="ë°±ë¡œê·¸ ì •ë³´ í™•ì¸ ë° ê¸°ì¡´ ë¶„ì„ ì²´í¬">

<check if="invoked from another workflow">
  <action>ì „ë‹¬ë°›ì€ íŒŒë¼ë¯¸í„° í™•ì¸:
  - backlog_id: {backlog_id}
  - backlog_content: {backlog_content}
  - backlog_folder: {backlog_folder}
  - analysis_depth: {analysis_depth} (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
  - force_new: {force_new} (ì—†ìœ¼ë©´ false)
  </action>
</check>

<check if="standalone execution">
  <ask>ë¶„ì„í•  ë°±ë¡œê·¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:

**ì…ë ¥ ë°©ì‹:**

1. ê¸°ì¡´ ë°±ë¡œê·¸ í´ë” ê²½ë¡œ ì…ë ¥ (ì˜ˆ: data/backlogs/12345, data/tasks/12345)
2. ìƒˆ ë°±ë¡œê·¸ ë‚´ìš© ì§ì ‘ ì…ë ¥</ask>

  <check if="option 1 - existing folder">
    <action>ë°±ë¡œê·¸ í´ë”ì—ì„œ backlog-info.yaml ë¡œë“œ</action>
    <action>ë°±ë¡œê·¸ ID ë° ë‚´ìš© ì¶”ì¶œ</action>
  </check>

  <check if="option 2 - new backlog">
    <ask>ë°±ë¡œê·¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:
- ì œëª©
- ì„¤ëª…/ìš”êµ¬ì‚¬í•­
- ê´€ë ¨ í‚¤ì›Œë“œ (ìˆë‹¤ë©´)</ask>
    <action>ë°±ë¡œê·¸ ID ìë™ ìƒì„±: {YYYYMMDD}-{HHMMSS}</action>
    <ask>ë¶„ì„ ê²°ê³¼ë¥¼ ì €ì¥í•  í´ë”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:
- [b] backlogs í´ë” ({backlogs_folder})
- [t] tasks í´ë” ({tasks_folder})
- [c] ì»¤ìŠ¤í…€ ê²½ë¡œ ì…ë ¥</ask>
  </check>
</check>

<action>ê¸°ì¡´ ë¶„ì„ ê²°ê³¼ í™•ì¸: {backlog_folder}/{analysis_filename}</action>

<check if="existing analysis found AND force_new != true">
  <action>ê¸°ì¡´ ë¶„ì„ ì •ë³´ í‘œì‹œ:

**ê¸°ì¡´ ì½”ë“œ ë¶„ì„ ë°œê²¬:**

- ìœ„ì¹˜: {backlog_folder}/{analysis_filename}
- ìƒì„±ì¼: {analysis_created_date}
- ë¶„ì„ ê¹Šì´: {previous_analysis_depth}
- ë¶„ì„ëœ íŒŒì¼ ìˆ˜: {previous_file_count}ê°œ
  </action>

  <ask>ê¸°ì¡´ ë¶„ì„ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ê¹Œìš”?

- [r] ì¬ì‚¬ìš© - ê¸°ì¡´ ë¶„ì„ ê²°ê³¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- [u] ì—…ë°ì´íŠ¸ - ê¸°ì¡´ ë¶„ì„ì— ì¶”ê°€ ë¶„ì„ ë³‘í•©
- [n] ìƒˆë¡œ ë¶„ì„ - ê¸°ì¡´ ë¶„ì„ ë¬´ì‹œí•˜ê³  ì²˜ìŒë¶€í„°</ask>

    <check if="response == 'r'">
      <action>ê¸°ì¡´ ë¶„ì„ ê²°ê³¼ë¥¼ {code_analysis} ë³€ìˆ˜ì— ë¡œë“œ</action>
      <action>ë¶„ì„ ê²°ê³¼ ìš”ì•½ í‘œì‹œ</action>
      <goto step="5">Complete with existing analysis</goto>
    </check>

    <check if="response == 'u'">
      <action>ê¸°ì¡´ ë¶„ì„ ê²°ê³¼ë¥¼ {existing_analysis} ë³€ìˆ˜ì— ë¡œë“œ</action>
      <action>ì—…ë°ì´íŠ¸ ëª¨ë“œë¡œ ì§„í–‰</action>
    </check>
  </check>

<check if="no existing analysis OR force_new == true">
  <action>ìƒˆ ë¶„ì„ ì§„í–‰</action>
</check>

<template-output>analysis_setup</template-output>
</step>

<step n="2" goal="ë¶„ì„ ê¹Šì´ ë° ë²”ìœ„ ì„ íƒ">

<check if="analysis_depth not provided">
  <ask>ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ê¹Šì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:

| ì˜µì…˜                  | ì„¤ëª…                                     | ì˜ˆìƒ íŒŒì¼ ìˆ˜                 | ì†Œìš” ì‹œê°„ |
| --------------------- | ---------------------------------------- | ---------------------------- | --------- |
| **[q] quick**         | ë¹ ë¥¸ íƒìƒ‰ - í‚¤ì›Œë“œ ê²€ìƒ‰, íŒŒì¼ ëª©ë¡       | ~{max_files_quick}ê°œ         | ~1ë¶„      |
| **[s] standard**      | í‘œì¤€ ë¶„ì„ - + ì˜ì¡´ì„± ë§µ, ì•„í‚¤í…ì²˜ íŒ¨í„´   | ~{max_files_standard}ê°œ      | ~3ë¶„      |
| **[d] deep**          | ì‹¬ì¸µ ë¶„ì„ - + í•¨ìˆ˜/í´ë˜ìŠ¤ ë ˆë²¨ ë¶„ì„      | ~{max_files_deep}ê°œ          | ~5ë¶„      |
| **[c] comprehensive** | ì¢…í•© ë¶„ì„ - + í…ŒìŠ¤íŠ¸ ë²”ìœ„, ë¦¬íŒ©í† ë§ ì œì•ˆ | ~{max_files_comprehensive}ê°œ | ~10ë¶„     |

(ê¸°ë³¸ê°’: {default_depth})</ask>

<action>ì„ íƒëœ ê¹Šì´ë¥¼ {analysis_depth}ì— ì €ì¥</action>
</check>

<action>ë¶„ì„ ê¹Šì´ì— ë”°ë¥¸ ì„¤ì • ì ìš©:

**{analysis_depth} ëª¨ë“œ ì„¤ì •:**

- ìµœëŒ€ íŒŒì¼ ìˆ˜: {max_files_for_depth}
- ì˜ì¡´ì„± ë¶„ì„: {include_deps_for_depth}
- í…ŒìŠ¤íŠ¸ ë¶„ì„: {include_tests_for_depth}
- í•¨ìˆ˜ ë ˆë²¨ ë¶„ì„: {include_function_level}
- ë¦¬íŒ©í† ë§ ì œì•ˆ: {include_refactoring}
  </action>

<ask>ë¶„ì„ ë²”ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:

- [a] ìë™ íƒìƒ‰ (í‚¤ì›Œë“œ ê¸°ë°˜ ì „ì²´ íƒìƒ‰) - ê¶Œì¥
- [p] ê²½ë¡œ ì§€ì • (íŠ¹ì • ê²½ë¡œë§Œ ë¶„ì„)
- [b] ë‘˜ ë‹¤ (ìë™ íƒìƒ‰ + íŠ¹ì • ê²½ë¡œ)</ask>

<check if="response == 'p' OR response == 'b'">
  <ask>ë¶„ì„í•  ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„):
ì˜ˆ: src/features/user, src/components, src/api</ask>
  <action>ì…ë ¥ëœ ê²½ë¡œë¥¼ {custom_paths}ì— ì €ì¥</action>
</check>

<template-output>analysis_config</template-output>
</step>

<step n="3" goal="ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ìˆ˜í–‰">

<action>ë°±ë¡œê·¸ì—ì„œ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ:

**í‚¤ì›Œë“œ ì¶”ì¶œ ì†ŒìŠ¤:**

- ë°±ë¡œê·¸ ì œëª©
- ì„¤ëª…/ìš”êµ¬ì‚¬í•­
- ìˆ˜ìš© ê¸°ì¤€
- ê¸°ìˆ ì  ì–¸ê¸‰ (API, ì»´í¬ë„ŒíŠ¸, ì„œë¹„ìŠ¤ ë“±)

**ì¶”ì¶œëœ í‚¤ì›Œë“œ:** {extracted_keywords}
</action>

<action>í”„ë¡œì íŠ¸ ê¸°ìˆ  ìŠ¤íƒ íŒŒì•…:

- package.json / requirements.txt / go.mod ë“± í™•ì¸
- í”„ë ˆì„ì›Œí¬ ê°ì§€ (React, Vue, Next.js, NestJS ë“±)
- ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‹ë³„
  </action>

<action>í‚¤ì›Œë“œë¡œ ê´€ë ¨ íŒŒì¼ ê²€ìƒ‰ (Grep, Glob, SERENA MCP í™œìš©):

**ê²€ìƒ‰ ì „ëµ:**

1. íŒŒì¼ëª… ë§¤ì¹­: {keywords}ë¥¼ í¬í•¨í•˜ëŠ” íŒŒì¼
2. ë‚´ìš© ë§¤ì¹­: {keywords}ë¥¼ í¬í•¨í•˜ëŠ” ì½”ë“œ
3. import/require ì¶”ì : ê´€ë ¨ ëª¨ë“ˆ ì˜ì¡´ì„±
   </action>

<check if="analysis_depth == 'quick'">
  <action>Quick ë¶„ì„ ìˆ˜í–‰:
  - ê´€ë ¨ íŒŒì¼ ëª©ë¡ ìƒì„± (ìµœëŒ€ {max_files_quick}ê°œ)
  - ê° íŒŒì¼ì˜ ê°„ë‹¨í•œ ì—­í•  ì„¤ëª…
  - ê¸°ë³¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° íŒŒì•…
  </action>
</check>

<check if="analysis_depth == 'standard'">
  <action>Standard ë¶„ì„ ìˆ˜í–‰:
  - ê´€ë ¨ íŒŒì¼ ëª©ë¡ ìƒì„± (ìµœëŒ€ {max_files_standard}ê°œ)
  - ê° íŒŒì¼ì˜ ì—­í•  ë° ì±…ì„ ë¶„ì„
  - íŒŒì¼ ê°„ ì˜ì¡´ì„± ë§µ ìƒì„±
  - ì•„í‚¤í…ì²˜ íŒ¨í„´ ì‹ë³„ (MVC, í´ë¦° ì•„í‚¤í…ì²˜, ë ˆì´ì–´ë“œ ë“±)
  - ë„¤ì´ë° ì»¨ë²¤ì…˜ íŒŒì•…
  </action>
</check>

<check if="analysis_depth == 'deep'">
  <action>Deep ë¶„ì„ ìˆ˜í–‰:
  - ê´€ë ¨ íŒŒì¼ ëª©ë¡ ìƒì„± (ìµœëŒ€ {max_files_deep}ê°œ)
  - Standard ë¶„ì„ ë‚´ìš© í¬í•¨
  - ì£¼ìš” í•¨ìˆ˜/í´ë˜ìŠ¤/ë©”ì„œë“œ ë ˆë²¨ ë¶„ì„
  - í˜¸ì¶œ íë¦„ (call flow) íŒŒì•…
  - ë°ì´í„° íë¦„ ì¶”ì 
  - ì—ëŸ¬ í•¸ë“¤ë§ íŒ¨í„´ ë¶„ì„
  </action>
</check>

<check if="analysis_depth == 'comprehensive'">
  <action>Comprehensive ë¶„ì„ ìˆ˜í–‰:
  - ê´€ë ¨ íŒŒì¼ ëª©ë¡ ìƒì„± (ìµœëŒ€ {max_files_comprehensive}ê°œ)
  - Deep ë¶„ì„ ë‚´ìš© í¬í•¨
  - ê´€ë ¨ í…ŒìŠ¤íŠ¸ íŒŒì¼ ë¶„ì„
  - í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì˜ˆìƒ
  - ì½”ë“œ í’ˆì§ˆ ì´ìŠˆ ì‹ë³„
  - ë¦¬íŒ©í† ë§ ê¸°íšŒ ì œì•ˆ
  - ê¸°ìˆ  ë¶€ì±„ ì‹ë³„
  </action>
</check>

<check if="existing_analysis exists (update mode)">
  <action>ê¸°ì¡´ ë¶„ì„ê³¼ ìƒˆ ë¶„ì„ ë³‘í•©:
  - ìƒˆë¡œ ë°œê²¬ëœ íŒŒì¼ ì¶”ê°€
  - ë³€ê²½ëœ íŒŒì¼ ì—…ë°ì´íŠ¸
  - ì‚­ì œëœ íŒŒì¼ ì œê±°
  - ì˜ì¡´ì„± ë§µ ê°±ì‹ 
  </action>
</check>

<template-output>analysis_in_progress</template-output>
</step>

<step n="4" goal="ë¶„ì„ ê²°ê³¼ ì •ë¦¬ ë° ì €ì¥">

<action>ë¶„ì„ ê²°ê³¼ë¥¼ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬:

```markdown
# ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ê²°ê³¼

**ë°±ë¡œê·¸:** {backlog_title}
**ë¶„ì„ì¼:** {date}
**ë¶„ì„ ê¹Šì´:** {analysis_depth}
**ë¶„ì„ëœ íŒŒì¼:** {file_count}ê°œ

---

## 1. ê¸°ìˆ  ìŠ¤íƒ

| ì¹´í…Œê³ ë¦¬        | ê¸°ìˆ                    |
| --------------- | ---------------------- |
| ì–¸ì–´            | {languages}            |
| í”„ë ˆì„ì›Œí¬      | {frameworks}           |
| ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ | {libraries}            |
| ì•„í‚¤í…ì²˜ íŒ¨í„´   | {architecture_pattern} |

## 2. ê´€ë ¨ íŒŒì¼ ëª©ë¡

| #   | íŒŒì¼ ê²½ë¡œ     | ì—­í•      | ìˆ˜ì • í•„ìš”  | ìš°ì„ ìˆœìœ„     |
| --- | ------------- | -------- | ---------- | ------------ |
| 1   | {file_path_1} | {role_1} | {modify_1} | {priority_1} |
| 2   | {file_path_2} | {role_2} | {modify_2} | {priority_2} |
| ... | ...           | ...      | ...        | ...          |

## 3. ì˜ì¡´ì„± ë§µ
```

{dependency_diagram}

```

**ì£¼ìš” ì˜ì¡´ ê´€ê³„:**
- {file_a} â†’ {file_b}: {relationship_description}
- ...

## 4. ì•„í‚¤í…ì²˜ ë¶„ì„

### í˜„ì¬ êµ¬ì¡°
{current_architecture_description}

### ê´€ë ¨ ë ˆì´ì–´/ëª¨ë“ˆ
- **{layer_1}**: {layer_1_description}
- **{layer_2}**: {layer_2_description}

## 5. êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­

### ê¸°ì¡´ íŒ¨í„´ ì¤€ìˆ˜
- {pattern_1}: {pattern_1_description}
- {pattern_2}: {pattern_2_description}

### ì ì¬ì  ì¶©ëŒ ì˜ì—­
- {conflict_area_1}
- {conflict_area_2}

### í…ŒìŠ¤íŠ¸ í•„ìš” ë²”ìœ„
- {test_scope_1}
- {test_scope_2}

<check if="analysis_depth == 'deep' OR analysis_depth == 'comprehensive'">
## 6. ìƒì„¸ ë¶„ì„

### ì£¼ìš” í•¨ìˆ˜/í´ë˜ìŠ¤
| ì´ë¦„ | ìœ„ì¹˜ | ì—­í•  | ìˆ˜ì • ê°€ëŠ¥ì„± |
|------|------|------|------------|
| {symbol_1} | {location_1} | {role_1} | {modify_likelihood_1} |
| ... | ... | ... | ... |

### í˜¸ì¶œ íë¦„
```

{call_flow_diagram}

```
</check>

<check if="analysis_depth == 'comprehensive'">
## 7. í’ˆì§ˆ ë° ê°œì„  ì œì•ˆ

### í…ŒìŠ¤íŠ¸ í˜„í™©
- ê´€ë ¨ í…ŒìŠ¤íŠ¸ íŒŒì¼: {test_files_count}ê°œ
- ì˜ˆìƒ ì»¤ë²„ë¦¬ì§€: {estimated_coverage}%

### ë¦¬íŒ©í† ë§ ê¸°íšŒ
- {refactoring_opportunity_1}
- {refactoring_opportunity_2}

### ê¸°ìˆ  ë¶€ì±„
- {tech_debt_1}
- {tech_debt_2}
</check>

---

## Dev ì—ì´ì „íŠ¸ ì°¸ê³ ì‚¬í•­

**ì‘ì—… ì‹œì‘ ì „ í™•ì¸:**
1. {checklist_item_1}
2. {checklist_item_2}
3. {checklist_item_3}

**ê¶Œì¥ ì‘ì—… ìˆœì„œ:**
1. {recommended_order_1}
2. {recommended_order_2}
3. {recommended_order_3}

**ì°¸ì¡°í•  ê¸°ì¡´ êµ¬í˜„:**
- {reference_implementation_1}
- {reference_implementation_2}
```

</action>

<action>ë¶„ì„ ê²°ê³¼ ì €ì¥: {backlog_folder}/{analysis_filename}</action>

<action>backlog-info.yaml ì—…ë°ì´íŠ¸ (code_context ì„¹ì…˜ ì¶”ê°€/ê°±ì‹ ):

```yaml
code_context:
  analysis_date: { date }
  analysis_depth: { analysis_depth }
  file_count: { file_count }
  target_files:
    - { file_1 }
    - { file_2 }
  architecture_pattern: { architecture_pattern }
  tech_stack:
    languages: [{ languages }]
    frameworks: [{ frameworks }]
  implementation_notes:
    - { note_1 }
    - { note_2 }
```

</action>

<template-output>analysis_saved</template-output>
</step>

<step n="5" goal="ë¶„ì„ ê²°ê³¼ ìš”ì•½ ë° ì™„ë£Œ">

<action>ë¶„ì„ ê²°ê³¼ ìš”ì•½ í‘œì‹œ:

**âœ… ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ ì™„ë£Œ!**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**ğŸ“Š ë¶„ì„ ìš”ì•½:**

- ë°±ë¡œê·¸: {backlog_title}
- ë¶„ì„ ê¹Šì´: {analysis_depth}
- ë¶„ì„ëœ íŒŒì¼: {file_count}ê°œ
- ìˆ˜ì • í•„ìš” íŒŒì¼: {modify_count}ê°œ

**ğŸ“ ì €ì¥ ìœ„ì¹˜:**

- {backlog_folder}/{analysis_filename}

**ğŸ”‘ í•µì‹¬ ë°œê²¬ì‚¬í•­:**

1. {key_finding_1}
2. {key_finding_2}
3. {key_finding_3}

**âš ï¸ ì£¼ìš” ì£¼ì˜ì‚¬í•­:**

- {main_caution_1}
- {main_caution_2}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
</action>

<check if="invoked from another workflow">
  <action>ë¶„ì„ ê²°ê³¼ë¥¼ í˜¸ì¶œ ì›Œí¬í”Œë¡œìš°ì— ë°˜í™˜:
  - {code_analysis}: ì „ì²´ ë¶„ì„ ê²°ê³¼ (ë§ˆí¬ë‹¤ìš´)
  - {target_files}: ìˆ˜ì • í•„ìš” íŒŒì¼ ëª©ë¡
  - {implementation_notes}: êµ¬í˜„ ì£¼ì˜ì‚¬í•­
  - {analysis_path}: ì €ì¥ëœ íŒŒì¼ ê²½ë¡œ
  </action>
  <action>í˜¸ì¶œ ì›Œí¬í”Œë¡œìš°ë¡œ ì œì–´ ë°˜í™˜</action>
</check>

<check if="standalone execution">
  <ask>ë‹¤ìŒ ì‘ì—…ì„ ì„ íƒí•´ì£¼ì„¸ìš”:

- [d] ë¶„ì„ ê²°ê³¼ ìƒì„¸ ë³´ê¸°
- [e] ë¶„ì„ ê²°ê³¼ ìˆ˜ì •/ë³´ì™„
- [p] PM ì—ì´ì „íŠ¸ë¡œ ëŒì•„ê°€ê¸° (ë°±ë¡œê·¸ ë¶„í•´ ì§„í–‰)
- [v] Dev ì—ì´ì „íŠ¸ë¡œ ì „í™˜ (êµ¬í˜„ ì‹œì‘)
- [x] ì™„ë£Œ</ask>
      </check>

<template-output>analysis_complete</template-output>
</step>

</workflow>
